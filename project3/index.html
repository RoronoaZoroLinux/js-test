<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">

    <title>piyano</title>

    <style>
   .img_key{
    background: url(sprites.png) 0px;
    
    height: 550px;
    width: 100px;
  
   
    
   }

   .img_key_black{
    background: url(sprites.png) 1000px;
    
    height: 550px;
    width: 100px;
    position: fixed;
    left: 50px;
    transform-origin: top center;
    scale: 0.6 0.7;
    overflow: hidden;
  
   }
   .keyboard{
    display: flex;

   

   }
   p{
    display: flex;
    align-items: flex-end;
    text-align: center;
    justify-content: center;
    font-size: 32px;
    user-select: none;

   }
   .note{
    display: none;
    font-weight: bold;
    opacity: 0.7;
    margin-bottom: 50px;
   }


    </style>
  </head>

  <body>

    <span class="keyboard">
    <p data-key="1"  class="img_key"> <span class="note">do</span> </p>
    <p data-key="2"  class="img_key"> <span class="note">re</span> </p>
    <p data-key="3"  class="img_key"><span class="note">mi</span></p>
    <p data-key="4"  class="img_key"><span class="note">fa</span></p>
    <p data-key="5"  class="img_key"><span class="note">sol</span></p>
    <p data-key="6"  class="img_key"><span class="note">la</span></p>
    <p data-key="7"  class="img_key"><span class="note">si</span></p>
    <p data-key="8"  class="img_key"><span class="note">do</span></p>
    <p data-key="9"  class="img_key"><span class="note">re</span></p>
    <p data-key="10" class="img_key"><span class="note">mi</span></p>
    <p data-key="11" data-pos="0" class="img_key_black"></p>
    <p data-key="12" data-pos="1" class="img_key_black"></p>
    <p data-key="13" data-pos="3" class="img_key_black"></p>
    <p data-key="14" data-pos="4" class="img_key_black"></p>
    <p data-key="15" data-pos="5" class="img_key_black"></p>
    <p data-key="16" data-pos="7" class="img_key_black"></p>
    <p data-key="17" data-pos="8" class="img_key_black"></p>
  

    </span>
    <button onclick="showNotes()">show notes</button>


</body>

<script>

    const sounds =[];

    for (let i = 0 ; i < 17 ; i++){

      sounds[i] = new Audio(`notes/${i+1}.mp3`);
      
    }


    

    let key = document.querySelectorAll('.img_key');
    let key2 = document.querySelectorAll('.img_key_black');
  
    const array_white_keys = Array.from(key);
    const array_black_keys = Array.from(key2)
    const all_keys = array_white_keys.concat(array_black_keys); 

    

    all_keys.forEach(key => {
      key.addEventListener("mousedown" , key => playAnim(key))
    });

    array_black_keys.forEach(key => 
    {
      let datakey = key.dataset.pos;
      key.style.left = (datakey*100 + 50) + "px";
    
    });


  const playAnim = async (e) => {
  
    
    let black =false;

    sounds[(e.target.dataset.key)-1].currentTime = 0;
    sounds[(e.target.dataset.key)-1].play();


    if(e.target.className == "img_key_black"){   
      black =true;
    }
  

    for ( let i = 1 ; i < 10 ; i++) {


      await new Promise(r => setTimeout(r, 10));
      
      if(black){
        e.target.style.background = `url(sprites.png) ${ -1000 - i*100}px`
      }
      else{
      e.target.style.background = `url(sprites.png) ${ i*-100}px`
      }
    }
    
    for ( let i = 1 ; i < 11 ; i++) {

      await new Promise(r => setTimeout(r, 10));

      if(black){
        e.target.style.background = `url(sprites.png) ${ -2000 + i*100}px`
      }
      else{
        e.target.style.background = `url(sprites.png) ${(-1000)+(i*100)}px`
      }
      
      
    }


}


function showNotes(){
  
   Array.from(document.querySelectorAll(".note")).forEach( element => { if(element.style.display ==='inline'){element.style.display ='none'}else{element.style.display ='inline'} })
}

const enumKeys = {

q: 1, Q:1,
w: 2, W:2,
e: 3, E:3,
r: 4, R:4,
t: 5, T:5,
y: 6, Y:6,
u: 7, u:7,
Ä±: 8, I:8, i:8,
o: 9, O:9,
p: 10, P:10



}

window.addEventListener("keydown", e=> {
  
  if(!enumKeys[e.key]) return;

   
   let val = document.querySelector(`[data-key="${enumKeys[e.key]}"]`);
   val.style.background = 'URL("sprites.png") -500px'
   sounds[enumKeys[e.key]].currentTime =0;
   sounds[enumKeys[e.key]].play();

  })
</script>
</html>
